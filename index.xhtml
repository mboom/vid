<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="nl" lang="nl">
    <head>
        <style>
            video {
                height: 360px;
                width: 640px;
            }
        </style>
        <title>Overview</title>
    </head>


    <body>
        <script
          src="https://code.jquery.com/jquery-3.2.1.min.js"
          integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g="
          crossorigin="anonymous"></script>
        <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
        <script src="providers.js"></script>

  

        <script>
            //<![CDATA[
                var cameras = {
                    "list": [],


                    "selectCamera": function (id) {
                        for (let camera of this.list) {
                            if (camera.id === id) {
                                return camera;
                            }
                        }
                        throw new Error("camera not found");
                    },


                    "filter": function(key, value) {
                        var result = [];
                        for (let camera of this.list) {
                            if (typeof camera[key] !== "undefined" && camera[key] === value) {
                                result.push(camera);
                            }
                        }
                    },


                    "checkStream": function (id, stream) {
                        var cam = this.selectCamera(id);
                        if (stream === "live" && (typeof cam.stream === "undefined" || cam.stream === "")) {
                            return false;
                        }
                        return providers.checkStream(cam.provider, stream);
                    },


                    "checkSource": function (id, stream, protocol) {
                        return this.checkStream(id, stream) && providers.checkSource(this.selectCamera(id).provider, stream, protocol);
                    },


                    "getStream": function (id, stream, protocol) {
                        var source = id;
                        var cam = this.selectCamera(id);
                        if (stream === "live") {
                            source = cam.stream;
                        }
                        return providers.selectSource(cam.provider, stream, protocol).location(source);
                    }
                };


                $.getJSON("cameras.json", function (data) {
                    cameras.list = data;
                });
            //]]>
        </script>

  
          
        <script>
            var cctv = {
                addLive: function (src) {
                    var video = document.createElement("video");
                    video.setAttribute("autoplay", "");
                    video.setAttribute("controls", "");
                    video.setAttribute("data-dashjs-player", "");
                    video.setAttribute("src", src);
                    document.querySelector("body").appendChild(video);
                },


                addStatic: function (src) {
                    var img = document.createElement("img");
                    img.setAttribute("src", src());

                    var reload = function () {
                        setTimeout(reload, 2000);
                        img.setAttribute("src", src());
                    }
                    img.addEventListener("load", reload);

                    document.querySelector("body").appendChild(img);
                },


                addCamera: function (id) {
                    if (cameras.checkSource(id, "live", "HTTP Live Streaming")) {
                        cctv.addLive(cameras.getStream(id, "live", "HTTP Live Streaming"));
                    } else if (cameras.checkSource(id, "static", "image")) {
                        cctv.addStatic(function () { return cameras.getStream(id, "static", "image"); });
                    }
                },

                addList: function (list) {
                    for (camera of list) {
                        addCamera(camera.id);
                    }
                }
            };
        </script>
  
  
  
        <script>
            //<![CDATA[
                function testCCTV() {
                    for (var i = 0; i < 5; ++i) {
                        cctv.addLive(cameras.getStream(cameras.list[i].id, "live", "HTTP Live Streaming"));
                    }
                }

                function loadAll() {
                    for (let camera of cameras.list) {
                        cctv.addCamera(camera.id);
                    }
                }

                function loadVID() {
                    cctv.addList(cameras.filter("manager", "VID Nederland B.V."));
                }

                function loadGRT() {
                    cctv.addList(cameras.filter("manager", "Gemeente Rotterdam"));
                }

                function loadTM() {
                    cctv.addList(cameras.filter("manager", "Twente Mobiel"));
                }
            //]]>
        </script>
    </body>
</html>
